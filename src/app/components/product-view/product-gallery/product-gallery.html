@if (images.length > 0) {
  <div class="space-y-4">
    <!-- Main Image -->
    <div class="relative bg-white rounded-xl shadow-sm p-4">
      <div class="relative aspect-square overflow-hidden rounded-lg">
        <img 
          [src]="images[selectedImageIndex()]?.src" 
          [alt]="images[selectedImageIndex()]?.alt"
          class="w-full h-full object-contain cursor-zoom-in"
          (click)="toggleFullscreen()"
          loading="lazy"
        />
        
        <!-- Navigation Arrows -->
        @if (images.length > 1) {
          <div class="absolute inset-0 flex items-center justify-between p-4">
            <button
              (click)="prevImage(); $event.stopPropagation()"
              class="w-10 h-10 flex items-center justify-center bg-white/80 hover:bg-white rounded-full shadow-lg"
              aria-label="Previous image"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            <button
              (click)="nextImage(); $event.stopPropagation()"
              class="w-10 h-10 flex items-center justify-center bg-white/80 hover:bg-white rounded-full shadow-lg"
              aria-label="Next image"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        }
        
        <!-- Fullscreen Toggle -->
        <button
          (click)="toggleFullscreen(); $event.stopPropagation()"
          class="absolute bottom-4 right-4 w-10 h-10 flex items-center justify-center bg-white/80 hover:bg-white rounded-full shadow-lg"
          aria-label="Toggle fullscreen"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Thumbnail Gallery -->
    @if (images.length > 1) {
      <div class="flex gap-2 overflow-x-auto py-2 px-1">
        @for (image of images; track $index) {
          <button
            (click)="selectImage($index)"
            [class.ring-2]="selectedImageIndex() === $index"
            [class.ring-blue-500]="selectedImageIndex() === $index"
            class="shrink-0 w-20 h-20 rounded-lg overflow-hidden border border-gray-200 hover:border-blue-300 transition-all duration-200"
            [attr.aria-label]="'View image ' + ($index + 1)"
          >
            <img 
              [src]="image.thumbnail" 
              [alt]="image.alt"
              class="w-full h-full object-cover hover:scale-105 transition-transform"
              loading="lazy"
            />
          </button>
        }
      </div>
    }
  </div>

  <!-- Fullscreen Modal -->
  @if (isFullscreen()) {
    <div 
      class="fixed inset-0 z-50 bg-black bg-opacity-95 flex items-center justify-center"
      (keydown)="handleKeyDown($event)"
      tabindex="0"
      role="dialog"
      aria-label="Product image gallery"
      #fullscreenModal
    >
      <!-- Close Button -->
      <button
        (click)="toggleFullscreen()"
        class="absolute top-4 right-4 text-white hover:text-gray-300 z-10"
        aria-label="Close fullscreen"
      >
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>

      <!-- Navigation Arrows -->
      @if (images.length > 1) {
        <button
          (click)="prevImage()"
          class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300"
          aria-label="Previous image"
        >
          <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        
        <button
          (click)="nextImage()"
          class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300"
          aria-label="Next image"
        >
          <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      }

      <!-- Current Image -->
      <div class="max-w-4xl max-h-[90vh] p-4">
        <img 
          [src]="images[selectedImageIndex()]?.src" 
          [alt]="images[selectedImageIndex()]?.alt"
          class="w-full h-full object-contain"
        />
      </div>

      <!-- Image Counter -->
      <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-sm">
        {{ selectedImageIndex() + 1 }} / {{ images.length }}
      </div>
    </div>
  }
} @else {
  <!-- Placeholder when no images -->
  <div class="aspect-square bg-gray-100 rounded-xl flex items-center justify-center">
    <div class="text-center text-gray-400">
      <svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      <p class="text-sm">No images available</p>
    </div>
  </div>
}